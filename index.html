<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Fiber Optic Loss Budget Calculator</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Hanuman:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script> <!-- For PDF Export -->
</head>
<body class="dark">
    <header>
        <h1>Advanced Fiber Optic Loss Budget Calculator</h1>
        <div class="controls">
            <button onclick="showReadme()">Readme & Links</button>
            <label>
                <input type="checkbox" id="dark-mode-toggle" checked onchange="toggleDarkMode()"> Dark Mode
            </label>
            <div class="font-control" title="Adjust font size for content (controls remain fixed)">
                <label>Content Font Size:</label>
                <button onclick="changeFontSize(-1)">-</button>
                <input type="range" id="font-size-slider" min="8" max="20" value="14" oninput="updateFontSize()">
                <button onclick="changeFontSize(1)">+</button>
            </div>
        </div>
    </header>

    <div class="tabs">
        <button class="tab-button active" onclick="openTab('calculator')">Loss Calculator</button>
        <button class="tab-button" onclick="openTab('otdr')">OTDR Guide</button>
    </div>

    <div id="calculator" class="tab-content active content-text" aria-label="Loss Calculator Tab">
        <div class="input-section" id="segments-container">
            <!-- Segments will be dynamically added here -->
        </div>
        <div class="segment-controls">
            <button onclick="addSegment()">Add Segment (Max 3)</button>
        </div>
        <div class="global-inputs">
            <label title="Add a buffer for aging, bends, or uncertainties (default 3 dB).">Safety Margin (dB):</label>
            <input type="number" id="safety-margin" min="0" step="0.1" value="3" placeholder="e.g., 3" aria-label="Safety Margin">

            <label title="Toggle to override standard values with custom ones.">Use Custom Losses:</label>
            <input type="checkbox" id="custom-toggle" onchange="toggleCustomInputs()" aria-label="Toggle Custom Losses">

            <div id="custom-inputs" style="display: none;">
                <label title="Custom fiber attenuation per km.">Custom Attenuation (dB/km):</label>
                <input type="number" id="custom-attenuation" min="0" step="0.01" placeholder="e.g., 0.35" aria-label="Custom Attenuation">

                <label title="Custom loss per splice.">Custom Splice Loss (dB):</label>
                <input type="number" id="custom-splice" min="0" step="0.01" placeholder="e.g., 0.05" aria-label="Custom Splice Loss">

                <label title="Custom loss per connector.">Custom Connector Loss (dB):</label>
                <input type="number" id="custom-connector" min="0" step="0.01" placeholder="e.g., 0.25" aria-label="Custom Connector Loss">
            </div>
        </div>
        <div class="buttons">
            <button id="calculate-button" onclick="calculate()">Calculate</button>
            <button onclick="clearFields()">Clear</button>
            <button onclick="exportPDF()">Export PDF</button>
            <button onclick="copyResults()">Copy Results</button>
        </div>
        <div id="validation-summary" class="error-message" style="margin-top: 10px;"></div>
        <div id="output" class="output-section" aria-live="polite"></div>
    </div>

    <div id="otdr" class="tab-content content-text" aria-label="OTDR Guide Tab">
        <div class="image-section">
            <h2>Example OTDR Trace (Click to Enlarge)</h2>
            <img src="otdr_example.png" alt="Example OTDR Trace" id="otdr-image" onclick="enlargeImage()">
            <p id="image-fallback" style="display: none;">Image 'otdr_example.png' not found. Upload it to the repo to display here.</p>
        </div>
        <div class="instructions">
            <h1>Reading an OTDR Trace: A Step-by-Step Guide</h1>
            <h2>Which Wavelength Report to Use?</h2>
            <p><strong>▪ Single-Mode (OS2):</strong> Always use the 1550nm report as your reference. It is more sensitive to bends and losses, giving you the most accurate splice count for your budget.</p>
            <p><strong>▪ Multi-Mode (OMx):</strong> Use the 850nm report. This is the primary transmission wavelength and its higher natural loss provides a 'worst-case' scenario for a safe, conservative budget.</p>
            <h2>Key Features to Identify (using an OS2 1550nm report as an example):</h2>
            <p><strong>1. Fusion Splices (e.g., Event 3 at 2820.13m)</strong><br>A small, sharp drop with no reflection. A loss of &lt;0.1 dB (like 0.042 dB) is a high-quality splice.</p>
            <p><strong>2. End of Fiber (e.g., Event 8 at 7822.36m)</strong><br>The final event is a large reflective spike, marking the end of the line.</p>
        </div>
    </div>


    <div id="readme-modal" class="modal" aria-label="Readme and Standards Modal">
    <div class="modal-content">
        <span class="close" onclick="closeReadme()" aria-label="Close">&times;</span>
        <h1>Standards & References (Non-Biased)</h1>
        <p>This calculator uses parameters from official, neutral industry standards (e.g., ITU-T, TIA, ISO/IEC). References are provided for verification and are not affiliated with any vendor. Always cross-check with primary sources for your specific use case.</p>
        <h2>Official Standards</h2>
        <p>▪ ITU-T G.652: Defines attenuation (dB/km) for single-mode fiber.<br>
        <a href="https://www.itu.int/rec/T-REC-G.652-201611-I/en" target="_blank">View Standard (Free PDF)</a> | <a href="https://handle.itu.int/11.1002/1000/13247" target="_blank">Permanent Link</a></p>
        <p>▪ TIA-568 Series: Sets max loss for connectors (0.75 dB) and splices (0.3 dB).<br>
        <a href="https://global.ihs.com/standards/tia/tia-568?search=true" target="_blank">View Standards (with Previews)</a> | <a href="https://web.archive.org/web/20230328105150/https://tiaonline.org/what-we-do/engineering-committees/tr-42/" target="_blank">Archived Overview</a></p>
        <p>▪ ISO/IEC 11801: The international equivalent of TIA-568.<br>
        <a href="https://www.iso.org/standard/76114.html" target="_blank">View Standard (with Preview)</a> | <a href="https://web.archive.org/web/20240101000000/https://www.iso.org/standard/76114.html" target="_blank">Archived Page</a></p>
        <h2>Power Budgets Explanation (100G Focus)</h2>
        <p>Power budgets are maximum allowable loss (dB) for reliable operation in applications like 100G Ethernet (common for data center interconnects). They come from standards like IEEE 802.3. Example: For 100G on OS2, budget is ~5 dB (for long-reach). The app compares your total loss to this for Pass/Fail status. Budgets vary by reach (short/long) and fiber—adjust safety margin for conservatism.<br>
        ▪ IEEE 802.3 (100G Budgets): <a href="https://standards.ieee.org/ieee/802.3/6943/" target="_blank">View Standard (Preview)</a> | <a href="https://web.archive.org/web/20230101000000/https://www.ieee802.org/3/" target="_blank">Archived IEEE 802.3 Site</a></p>
        <h2>Additional Learning Resources (Neutral Articles)</h2>
        <p>▪ Understanding Fiber Loss Calculation<br>
        <a href="https://www.fs.com/blog/understanding-fiber-loss-what-is-it-and-how-to-calculate-it-3792.html" target="_blank">Read on FS.com</a></p>
        <p>▪ Single-Mode vs. Multi-Mode Fiber Types<br>
        <a href="https://www.fs.com/blog/fiber-optic-cable-types-single-mode-vs-multimode-fiber-cable-1310.html" target="_blank">Read on FS.com</a></p>
        <p><em>Note: These are independent resources. If a link is unavailable, search the standard name on the official site or archive.org for alternatives. This tool is for educational purposes—verify calculations independently.</em></p>
    </div>
</div>

    <div id="image-modal" class="modal" aria-label="Enlarged Image Modal">
        <img src="otdr_example.png" alt="Enlarged OTDR Trace" class="modal-image">
        <span class="close" onclick="closeImageModal()" aria-label="Close">&times;</span>
    </div>

    <script src="script.js"></script>
</body>
</html>
