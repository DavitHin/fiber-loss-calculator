<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fiber Optic Loss Calculator</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script>
        function calculateLoss() {
            const form = document.getElementById('calc-form');
            const resultDiv = document.getElementById('result');
            fetch('/', {
                method: 'POST',
                body: new FormData(form),
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    resultDiv.innerHTML = `<p class="error">${data.error}</p>`;
                } else {
                    let html = `<h2>ðŸ“Š Link Loss Budget Results</h2><p><strong>Fiber Type:</strong> ${data.fiber_type}</p><hr>`;
                    for (const [wl, values] of Object.entries(data.wavelengths)) {
                        html += `<h3>ðŸ“ˆ Results for Wavelength: ${wl}</h3>`;
                        html += `<p><strong>Highest Acceptable Loss:</strong> <span class="pass">${values.max_loss} dB</span></p>`;
                        html += `<p><strong>Typical Good Performance:</strong> ${values.typ_loss} dB</p><hr>`;
                    }
                    resultDiv.innerHTML = html;
                }
            });
        }
        function clearFields() {
            document.getElementById('calc-form').reset();
            document.getElementById('result').innerHTML = '';
        }
    </script>
</head>
<body>
    <header>
        <h1>Advanced Fiber Optic Loss Budget Calculator</h1>
        <nav>
            <a href="/">Calculator</a> | <a href="/instructions">OTDR Guide</a>
        </nav>
    </header>
    <main>
        <div class="container">
            <div class="input-section">
                <h2>Input Parameters</h2>
                <div id="calc-form" class="form">
                    <label>Fiber Type:</label>
                    <select name="fiber_type">
                        {% for ft in fiber_types %}
                        <option value="{{ ft }}">{{ ft }}</option>
                        {% endfor %}
                    </select>
                    <label>Distance (meters):</label>
                    <input type="number" name="distance" required>
                    <label>Splice Count:</label>
                    <input type="number" name="splices" required>
                    <label>Connector Count:</label>
                    <input type="number" name="connectors" required>
                    <div class="buttons">
                        <button type="button" onclick="calculateLoss()">Calculate</button>
                        <button type="button" onclick="clearFields()">Clear</button>
                    </div>
                </div>
            </div>
            <div class="output-section">
                <h2>Results</h2>
                <div id="result"></div>
            </div>
        </div>
    </main>
</body>
</html>